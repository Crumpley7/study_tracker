<!DOCTYPE html>
<html lang="en">
<head>
    <title>Study Statistics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<nav class="navbar navbar-light bg-white shadow-sm mb-4">
    <div class="container">
        <a href="/" class="navbar-brand mb-0 h1 text-decoration-none">StudyTracker</a>
        <div class="d-flex align-items-center">
            <span class="me-3 text-muted d-none d-md-block">{{ user.email }}</span>
            <a href="/" class="btn btn-info btn-sm text-white me-2">Track</a>
            <a href="/logout" class="btn btn-outline-danger btn-sm">Logout</a>
        </div>
    </div>
</nav>

<div class="container pb-5">
    <h2 class="text-center mb-4">Progress Dashboard</h2>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm p-3 h-100">
                <h5 class="text-center">This Week (Mon-Sun)</h5>
                <canvas id="dailyChart"></canvas>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow-sm p-3 h-100">
                <h5 class="text-center">Weekly Trends</h5>
                <canvas id="weeklyChart"></canvas>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm p-3">
                <h5 class="text-center">Subject Distribution</h5>
                <div style="height: 300px; display: flex; justify-content: center;">
                    <canvas id="subjectChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. DAILY CHART ---
    const dailyCtx = document.getElementById('dailyChart').getContext('2d');
    new Chart(dailyCtx, {
        type: 'bar',
        data: {
            labels: JSON.parse('{{ daily_labels | safe }}'), // ["Mon", "Tue"...]
            datasets: [{
                label: 'Hours',
                data: JSON.parse('{{ daily_values | safe }}'),
                backgroundColor: '#36A2EB',
                borderRadius: 5
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { display: false } }
        }
    });

    // --- 2. WEEKLY CHART (NEW) ---
    const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
    new Chart(weeklyCtx, {
        type: 'bar',
        data: {
            labels: JSON.parse('{{ weekly_labels | safe }}'), // ["Jan 01-07", "Jan 08-14"...]
            datasets: [{
                label: 'Total Hours',
                data: JSON.parse('{{ weekly_values | safe }}'),
                backgroundColor: '#4BC0C0',
                borderRadius: 5
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { display: false } }
        }
    });

    // --- 3. SUBJECT CHART ---
    const subjectCtx = document.getElementById('subjectChart').getContext('2d');
    new Chart(subjectCtx, {
        type: 'doughnut',
        data: {
            labels: JSON.parse('{{ subject_labels | safe }}'),
            datasets: [{
                data: JSON.parse('{{ subject_values | safe }}'),
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#9966FF', '#FF9F40']
            }]
        },
        options: { maintainAspectRatio: false }
    });
</script>

</body>
</html>